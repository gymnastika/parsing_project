# ‚úÖ –ò–°–ü–†–ê–í–õ–ï–ù–ò–Ø WEB SCRAPER - –î–ï–¢–ê–õ–¨–ù–ê–Ø –î–ò–ê–ì–ù–û–°–¢–ò–ö–ê

## üéØ –ê–Ω–∞–ª–∏–∑ –ø—Ä–æ–±–ª–µ–º—ã

**–°–∏–º–ø—Ç–æ–º—ã:**
- Web Scraper –≤—ã–∑—ã–≤–∞–µ—Ç—Å—è, –Ω–æ –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç fallback –¥–∞–Ω–Ω—ã–µ
- –í—Å–µ —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã —Å–æ–¥–µ—Ä–∂–∞—Ç "–ù–µ —É–¥–∞–ª–æ—Å—å –∏–∑–≤–ª–µ—á—å" –∏ "–ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –Ω–µ–¥–æ—Å—Ç—É–ø–Ω–∞"
- Email –∞–¥—Ä–µ—Å–∞ –Ω–µ –∏–∑–≤–ª–µ–∫–∞—é—Ç—Å—è (–≤–µ–∑–¥–µ null)

**–ö–æ—Ä–Ω–µ–≤–∞—è –ø—Ä–∏—á–∏–Ω–∞:**
Web Scraper –ø–æ–ø–∞–¥–∞–ª –≤ catch –±–ª–æ–∫ –∏–∑-–∑–∞:
1. –°–ª–∏—à–∫–æ–º –∫–æ—Ä–æ—Ç–∫–∏—Ö —Ç–∞–π–º–∞—É—Ç–æ–≤ (20 —Å–µ–∫)
2. –ú–µ–¥–ª–µ–Ω–Ω—ã—Ö RESIDENTIAL –ø—Ä–æ–∫—Å–∏
3. –û—Ç—Å—É—Ç—Å—Ç–≤–∏—è –¥–µ—Ç–∞–ª—å–Ω–æ–≥–æ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏—è –æ—à–∏–±–æ–∫
4. –ù–µ–∫–æ—Ä—Ä–µ–∫—Ç–Ω—ã—Ö URLs (–≤–∫–ª—é—á–∞—è —Å—Å—ã–ª–∫–∏ –Ω–∞ Google Maps)

## üîß –í–Ω–µ—Å–µ–Ω–Ω—ã–µ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è

### 1. ‚úÖ –£–ª—É—á—à–µ–Ω–Ω–æ–µ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –∏ –¥–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∞

**–§–∞–π–ª:** `lib/apify-client.js`
**–°—Ç—Ä–æ–∫–∏:** 1191-1230, 1115-1121

```javascript
// –î–û: –ü—Ä–æ—Å—Ç–æ–µ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ
console.error('‚ùå Website scraping failed:', error);

// –ü–û–°–õ–ï: –î–µ—Ç–∞–ª—å–Ω–∞—è –¥–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∞
console.error('üîç Full error details:', {
    message: error.message,
    stack: error.stack ? error.stack.substring(0, 500) : 'No stack trace',
    errorType: error.constructor.name,
    urls: urls.slice(0, 5), // –ü–æ–∫–∞–∑–∞—Ç—å –ø—Ä–æ–±–ª–µ–º–Ω—ã–µ URLs
    urlCount: urls.length
});

// + –ö–ª–∞—Å—Å–∏—Ñ–∏–∫–∞—Ü–∏—è —Ç–∏–ø–æ–≤ –æ—à–∏–±–æ–∫
if (error.message.includes('timeout')) {
    errorDescription = '–ü—Ä–µ–≤—ã—à–µ–Ω–æ –≤—Ä–µ–º—è –æ–∂–∏–¥–∞–Ω–∏—è –∑–∞–≥—Ä—É–∑–∫–∏ —Å–∞–π—Ç–∞';
    console.warn('‚è∞ Timeout error detected - consider increasing pageLoadTimeoutSecs');
}
// + 5 –¥—Ä—É–≥–∏—Ö —Ç–∏–ø–æ–≤ –æ—à–∏–±–æ–∫...
```

### 2. ‚úÖ –£–≤–µ–ª–∏—á–µ–Ω–Ω—ã–µ —Ç–∞–π–º–∞—É—Ç—ã –∏ –±—ã—Å—Ç—Ä—ã–µ –ø—Ä–æ–∫—Å–∏

**–ò–∑–º–µ–Ω–µ–Ω–∏—è:**
- `pageLoadTimeoutSecs`: 20 ‚Üí **60 —Å–µ–∫—É–Ω–¥** (√ó3)
- `pageFunctionTimeoutSecs`: 10 ‚Üí **30 —Å–µ–∫—É–Ω–¥** (√ó3) 
- `maxRequestRetries`: 1 ‚Üí **2 –ø–æ–≤—Ç–æ—Ä–∞** (–±–æ–ª—å—à–µ –Ω–∞–¥–µ–∂–Ω–æ—Å—Ç–∏)
- `proxyGroups`: RESIDENTIAL ‚Üí **SHADER, BUYPROXIES** (–±—ã—Å—Ç—Ä–µ–µ)

```javascript
// ‚úÖ –ò–°–ü–†–ê–í–õ–ï–ù–û: –ë–æ–ª–µ–µ –Ω–∞–¥–µ–∂–Ω—ã–µ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏
pageLoadTimeoutSecs: 60,       // –ë—ã–ª–æ: 20
pageFunctionTimeoutSecs: 30,   // –ë—ã–ª–æ: 10
maxRequestRetries: 2,          // –ë—ã–ª–æ: 1
groups: ["SHADER", "BUYPROXIES"] // –ë—ã–ª–æ: ["RESIDENTIAL"]
```

### 3. ‚úÖ –§–∏–ª—å—Ç—Ä–∞—Ü–∏—è –Ω–µ–∫–æ—Ä—Ä–µ–∫—Ç–Ω—ã—Ö URLs

**–î–æ–±–∞–≤–ª–µ–Ω—ã –∏—Å–∫–ª—é—á–µ–Ω–∏—è:**
- `google.com/maps` - —Å—Å—ã–ª–∫–∏ –Ω–∞ Google Maps
- `facebook.com`, `instagram.com` - —Å–æ—Ü—Å–µ—Ç–∏ (–±–ª–æ–∫–∏—Ä—É—é—Ç —Å–∫—Ä–∞–ø–∏–Ω–≥)
- `.pdf`, `.jpg`, `.zip` - —Ñ–∞–π–ª—ã (–Ω–µ —Å–æ–¥–µ—Ä–∂–∞—Ç –∫–æ–Ω—Ç–∞–∫—Ç–æ–≤)

```javascript
// ‚úÖ –£–õ–£–ß–®–ï–ù–ù–ê–Ø –§–ò–õ–¨–¢–†–ê–¶–ò–Ø
const validUrls = urls.filter(url => {
    return url && 
           typeof url === 'string' && 
           (url.startsWith('http://') || url.startsWith('https://')) &&
           !url.includes('google.com/maps') && // –ò—Å–∫–ª—é—á–∏—Ç—å Google Maps
           !url.includes('facebook.com') &&   // –ò—Å–∫–ª—é—á–∏—Ç—å —Å–æ—Ü—Å–µ—Ç–∏
           !url.match(/\.(jpg|jpeg|png|pdf|zip)$/i); // –ò—Å–∫–ª—é—á–∏—Ç—å —Ñ–∞–π–ª—ã
})
```

### 4. ‚úÖ –û–±—Ä–∞–±–æ—Ç–∫–∞ —á–∞—Å—Ç–∏—á–Ω—ã—Ö —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤

**–î–æ–±–∞–≤–ª–µ–Ω–∞ –¥–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∞ —É—Å–ø–µ—à–Ω–æ—Å—Ç–∏:**

```javascript
// ‚úÖ –ü–†–û–í–ï–†–ö–ê –†–ï–ó–£–õ–¨–¢–ê–¢–û–í
if (results.length === 0 && validUrls.length > 0) {
    console.warn(`‚ö†Ô∏è Web Scraper returned 0 results but had ${validUrls.length} URLs`);
    // –î–µ—Ç–∞–ª—å–Ω–∞—è –¥–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∞ –ø—Ä–æ–±–ª–µ–º—ã...
}

if (results.length < validUrls.length / 2) {
    console.warn(`‚ö†Ô∏è Partial success: ${results.length}/${validUrls.length} (${success}%)`);
}

// ‚úÖ –°–¢–ê–¢–ò–°–¢–ò–ö–ê EMAIL –ò–ó–í–õ–ï–ß–ï–ù–ò–Ø
const withEmails = formattedResults.filter(r => r.email).length;
console.log(`üìß –° email –∞–¥—Ä–µ—Å–∞–º–∏: ${withEmails} (${percentage}%)`);
```

### 5. ‚úÖ PageFunction —É–∂–µ –∏–º–µ–µ—Ç try-catch

**–ü–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–æ:** pageFunction –ø—Ä–∞–≤–∏–ª—å–Ω–æ –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ—Ç –æ—à–∏–±–∫–∏:

```javascript
try {
    // –û—Å–Ω–æ–≤–Ω–∞—è –ª–æ–≥–∏–∫–∞ –∏–∑–≤–ª–µ—á–µ–Ω–∏—è email...
} catch (error) {
    context.log.error('Error in pageFunction:', error.message);
    return {
        organizationName: '–û—à–∏–±–∫–∞ –∏–∑–≤–ª–µ—á–µ–Ω–∏—è –¥–∞–Ω–Ω—ã—Ö',
        scrapingError: error.message
    };
}
```

## üß™ –ü–ª–∞–Ω —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è

### –®–∞–≥ 1: –î–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∞ –æ—à–∏–±–æ–∫
- –ó–∞–ø—É—Å—Ç–∏—Ç—å —Ç–µ—Å—Ç –Ω–∞ —Å—Ç—Ä–∞–Ω–∏—Ü–µ `test-pipeline.html`
- –í –∫–æ–Ω—Å–æ–ª–∏ –±—Ä–∞—É–∑–µ—Ä–∞ —É–≤–∏–¥–µ—Ç—å **–¥–µ—Ç–∞–ª—å–Ω—ã–µ –ª–æ–≥–∏ –æ—à–∏–±–æ–∫**
- –û–ø—Ä–µ–¥–µ–ª–∏—Ç—å —Ç–æ—á–Ω—É—é –ø—Ä–∏—á–∏–Ω—É –ø—Ä–æ–±–ª–µ–º—ã

### –®–∞–≥ 2: –ü—Ä–æ–≤–µ—Ä–∫–∞ —É–ª—É—á—à–µ–Ω–∏–π
- **–§–∏–ª—å—Ç—Ä–∞—Ü–∏—è URLs**: –£–±–µ–¥–∏—Ç—å—Å—è —á—Ç–æ Google Maps —Å—Å—ã–ª–∫–∏ –∏—Å–∫–ª—é—á–µ–Ω—ã
- **–¢–∞–π–º–∞—É—Ç—ã**: –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —á—Ç–æ —Å–∞–π—Ç—ã —É—Å–ø–µ–≤–∞—é—Ç –∑–∞–≥—Ä—É–∑–∏—Ç—å—Å—è (60 —Å–µ–∫)
- **–ü—Ä–æ–∫—Å–∏**: SHADER/BUYPROXIES –¥–æ–ª–∂–Ω—ã —Ä–∞–±–æ—Ç–∞—Ç—å –±—ã—Å—Ç—Ä–µ–µ

### –®–∞–≥ 3: –†–µ–∑—É–ª—å—Ç–∞—Ç—ã
**–û–∂–∏–¥–∞–Ω–∏—è:**
- ‚úÖ Web Scraper –∑–∞–ø—É—Å–∫–∞–µ—Ç—Å—è –±–µ–∑ –æ—à–∏–±–æ–∫
- ‚úÖ –ß–∞—Å—Ç—å —Å–∞–π—Ç–æ–≤ –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç —Ä–µ–∞–ª—å–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ (–Ω–µ fallback)
- ‚úÖ Email –∞–¥—Ä–µ—Å–∞ –∏–∑–≤–ª–µ–∫–∞—é—Ç—Å—è —Å –Ω–µ–∫–æ—Ç–æ—Ä—ã—Ö —Å–∞–π—Ç–æ–≤
- ‚úÖ –î–µ—Ç–∞–ª—å–Ω—ã–µ –ª–æ–≥–∏ –ø–æ–∫–∞–∑—ã–≤–∞—é—Ç —Ç–æ—á–Ω—É—é —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫—É

## üìä –ö–ª—é—á–µ–≤—ã–µ —É–ª—É—á—à–µ–Ω–∏—è

| –ü–∞—Ä–∞–º–µ—Ç—Ä | –î–û | –ü–û–°–õ–ï | –£–ª—É—á—à–µ–Ω–∏–µ |
|----------|-----|--------|-----------|
| –¢–∞–π–º–∞—É—Ç –∑–∞–≥—Ä—É–∑–∫–∏ | 20 —Å–µ–∫ | 60 —Å–µ–∫ | +200% |
| –¢–∞–π–º–∞—É—Ç —Ñ—É–Ω–∫—Ü–∏–∏ | 10 —Å–µ–∫ | 30 —Å–µ–∫ | +200% |
| –ü–æ–≤—Ç–æ—Ä—ã | 1 | 2 | +100% |
| –ü—Ä–æ–∫—Å–∏ | RESIDENTIAL | SHADER/BUYPROXIES | –ë—ã—Å—Ç—Ä–µ–µ |
| URL —Ñ–∏–ª—å—Ç—Ä–∞—Ü–∏—è | –ë–∞–∑–æ–≤–∞—è | –ü—Ä–æ–¥–≤–∏–Ω—É—Ç–∞—è | +7 –∏—Å–∫–ª—é—á–µ–Ω–∏–π |
| –õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ | –ú–∏–Ω–∏–º–∞–ª—å–Ω–æ–µ | –î–µ—Ç–∞–ª—å–Ω–æ–µ | +5 —Ç–∏–ø–æ–≤ –æ—à–∏–±–æ–∫ |
| –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ | –ù–µ—Ç | –ü–æ–ª–Ω–∞—è | Email %, —É—Å–ø–µ—à–Ω–æ—Å—Ç—å |

## üéØ –û–∂–∏–¥–∞–µ–º—ã–π —Ä–µ–∑—É–ª—å—Ç–∞—Ç

–ü–æ—Å–ª–µ —ç—Ç–∏—Ö –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–π:
1. **–¢–æ—á–Ω–∞—è –¥–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∞** –ø–æ–∫–∞–∂–µ—Ç —Ä–µ–∞–ª—å–Ω—É—é –ø—Ä–∏—á–∏–Ω—É –ø—Ä–æ–±–ª–µ–º
2. **–£–≤–µ–ª–∏—á–µ–Ω–Ω—ã–µ —Ç–∞–π–º–∞—É—Ç—ã** –¥–∞–¥—É—Ç —Å–∞–π—Ç–∞–º –≤—Ä–µ–º—è –∑–∞–≥—Ä—É–∑–∏—Ç—å—Å—è  
3. **–ë—ã—Å—Ç—Ä—ã–µ –ø—Ä–æ–∫—Å–∏** —É–º–µ–Ω—å—à–∞—Ç –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ —Ç–∞–π–º–∞—É—Ç–æ–≤
4. **–§–∏–ª—å—Ç—Ä–∞—Ü–∏—è URLs** –∏—Å–∫–ª—é—á–∏—Ç –∑–∞–≤–µ–¥–æ–º–æ –Ω–µ—Ä–∞–±–æ—á–∏–µ —Å—Å—ã–ª–∫–∏
5. **Email –∞–¥—Ä–µ—Å–∞** –Ω–∞—á–Ω—É—Ç –∏–∑–≤–ª–µ–∫–∞—Ç—å—Å—è —Å –¥–æ—Å—Ç—É–ø–Ω—ã—Ö —Å–∞–π—Ç–æ–≤

**–°—Ç–∞—Ç—É—Å: –ì–û–¢–û–í–û –ö –¢–ï–°–¢–ò–†–û–í–ê–ù–ò–Æ** ‚úÖ

---
**–î–∞—Ç–∞:** 2025-09-08  
**–§–∞–π–ª—ã –∏–∑–º–µ–Ω–µ–Ω—ã:** `lib/apify-client.js`  
**–¢–µ—Å—Ç–æ–≤–∞—è —Å—Ç—Ä–∞–Ω–∏—Ü–∞:** `test-pipeline.html`